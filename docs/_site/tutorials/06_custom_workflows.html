<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tutorial 6: Custom Processing Workflows – sarpyx Docs</title>
  <link rel="stylesheet" href="../assets/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="icon" href="../assets/sarpyx_logo.png" type="image/png">
</head>
<body>
  <button class="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">☰</button>
  <nav class="sidebar">
    <a href="../index.html"><img class="logo" src="../assets/sarpyx_logo.png" alt="sarpyx"></a>
    <h3>Home</h3>
<a href="../index.html">Introduction</a>
<h3>User Guide</h3>
<a href="../user_guide/index.html">Overview</a>
<a href="../user_guide/installation.html">Installation</a>
<a href="../user_guide/getting_started.html">Getting Started</a>
<a href="../user_guide/basic_concepts.html">Basic Concepts</a>
<a href="../user_guide/data_formats.html">Data Formats</a>
<a href="../user_guide/snap_integration.html">SNAP Integration</a>
<a href="../user_guide/processing_workflows.html">Processing Workflows</a>
<a href="../user_guide/science_applications.html">Science Applications</a>
<a href="../user_guide/troubleshooting.html">Troubleshooting</a>
<a href="../user_guide/INSTALL_S1ISP.html">Install S1-ISP</a>
<h3>Tutorials</h3>
<a href="../tutorials/index.html">Overview</a>
<a href="../tutorials/01_first_sublook_analysis.html">01 – Sub-Look Analysis</a>
<a href="../tutorials/02_snap_integration_basics.html">02 – SNAP Basics</a>
<a href="../tutorials/03_visualization_quality.html">03 – Visualisation</a>
<a href="../tutorials/04_multitemporal_analysis.html">04 – Multi-temporal</a>
<a href="../tutorials/05_polarimetric_analysis.html">05 – Polarimetry</a>
<a href="../tutorials/06_custom_workflows.html" class="active">06 – Custom Workflows</a>
<a href="../tutorials/07_ship_detection.html">07 – Ship Detection</a>
<a href="../tutorials/08_interferometric_analysis.html">08 – InSAR</a>
<h3>API Reference</h3>
<a href="../api/index.html">Overview</a>
<a href="../api/snapflow/index.html">Snapflow</a>
<a href="../api/snapflow/Snapflow_usage_example.html">Snapflow Examples</a>
<a href="../api/science/index.html">Science</a>
<a href="../api/sla/index.html">SLA</a>
<a href="../api/processor/index.html">Processor</a>
<a href="../api/utils/index.html">Utils</a>
<a href="../api/utils/dem_utils.html">DEM Utilities</a>
<h3>Examples</h3>
<a href="../examples/index.html">Overview</a>
<h3>Developer Guide</h3>
<a href="../developer_guide/architecture.html">Architecture</a>
<a href="../developer_guide/contributing.html">Contributing</a>
<h3>Reference</h3>
<a href="../metaParams.html">MetaParams</a>
  </nav>
  <main class="main">
    <h1 id="tutorial-6-custom-processing-workflows">Tutorial 6: Custom Processing Workflows</h1>
<p>Learn to build custom processing pipelines for specific applications using sarpyx&rsquo;s modular architecture.</p>
<h2 id="overview">Overview</h2>
<p>This tutorial covers:
- Building modular processing workflows
- Custom parameter optimization
- Application-specific pipeline design
- Error handling and robustness
- Performance optimization techniques
- Workflow automation and scripting
- Integration with external tools</p>
<p><strong>Duration</strong>: 40 minutes<br>
<strong>Prerequisites</strong>: Tutorials 1-5 completed<br>
<strong>Data</strong>: Various SAR products for different applications</p>
<h2 id="1-workflow-architecture-design">1. Workflow Architecture Design</h2>
<pre class="codehilite"><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sarpyx.sla</span><span class="w"> </span><span class="kn">import</span> <span class="n">SubLookAnalysis</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sarpyx.snapflow.engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">GPT</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sarpyx.science.indices</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sarpyx.utils.viz</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_image</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sarpyx.utils.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">save_matlab_mat</span>

<span class="c1"># Configure logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Set up directories</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;tutorial6_outputs&quot;</span>
<span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProcessingConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration class for processing parameters&quot;&quot;&quot;</span>
    <span class="n">input_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">band_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Sigma0_VV_slc&#39;</span>
    <span class="n">num_looks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">overlap_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">snap_processing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">generate_vegetation_indices</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">perform_decomposition</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quality_assessment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">save_intermediate_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ProcessingStep</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for processing steps&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_time</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the processing step&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate input data (override in subclasses)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">input_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">log_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log execution results&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; completed successfully in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; failed: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomWorkflow</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom processing workflow manager&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ProcessingConfig</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ProcessingStep</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_log</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">ProcessingStep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a processing step to the workflow&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added step &#39;</span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; to workflow &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the complete workflow&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting workflow &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span><span class="si">}</span><span class="s2"> steps&quot;</span><span class="p">)</span>

        <span class="n">current_data</span> <span class="o">=</span> <span class="n">input_data</span>
        <span class="n">workflow_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">step</span><span class="o">.</span><span class="n">validate_input</span><span class="p">(</span><span class="n">current_data</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid input for step &#39;</span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

                <span class="n">step_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">current_data</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">current_data</span><span class="p">)</span>
                <span class="n">step</span><span class="o">.</span><span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">step_start_time</span>

                <span class="c1"># Store intermediate results</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">results</span>

                <span class="n">step</span><span class="o">.</span><span class="n">log_execution</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">execution_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;execution_time&#39;</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">execution_time</span>
                <span class="p">})</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">step</span><span class="o">.</span><span class="n">log_execution</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">execution_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;failed&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">error_msg</span>
                <span class="p">})</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">save_intermediate_results</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">save_partial_results</span><span class="p">()</span>

                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Workflow failed at step &#39;</span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">workflow_start_time</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Workflow &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; completed successfully in </span><span class="si">{</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">current_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_partial_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save partial results for debugging&quot;&quot;&quot;</span>
        <span class="n">partial_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;partial_results.json&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">partial_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_log</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom workflow framework initialized&quot;</span><span class="p">)</span>
</code></pre>
<h2 id="2-specific-processing-steps-implementation">2. Specific Processing Steps Implementation</h2>
<h3 id="21-data-loading-and-validation-step">2.1 Data Loading and Validation Step</h3>
<pre class="codehilite"><code><span class="k">class</span><span class="w"> </span><span class="nc">DataLoadingStep</span><span class="p">(</span><span class="n">ProcessingStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load and validate SAR data&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Data Loading&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load SAR data from file path&quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">input_data</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input_path&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input file not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Initialize SLA processor</span>
        <span class="n">sla</span> <span class="o">=</span> <span class="n">SubLookAnalysis</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">band_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;band_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Sigma0_VV_slc&#39;</span><span class="p">)</span>
            <span class="n">sla</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">band_name</span><span class="o">=</span><span class="n">band_name</span><span class="p">)</span>

            <span class="c1"># Store metadata</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;sla_processor&#39;</span><span class="p">:</span> <span class="n">sla</span><span class="p">,</span>
                <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                <span class="s1">&#39;band_name&#39;</span><span class="p">:</span> <span class="n">band_name</span><span class="p">,</span>
                <span class="s1">&#39;data_shape&#39;</span><span class="p">:</span> <span class="n">sla</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="n">sla</span><span class="o">.</span><span class="n">metadata</span>
            <span class="p">}</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded data: </span><span class="si">{</span><span class="n">sla</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, band: </span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load data from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate file path exists&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SNAPPreprocessingStep</span><span class="p">(</span><span class="n">ProcessingStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;SNAP-based preprocessing step&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;SNAP Preprocessing&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gpt</span> <span class="o">=</span> <span class="n">GPT</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform SNAP preprocessing&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enable_snap&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;SNAP preprocessing disabled, skipping&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">input_data</span>

        <span class="n">file_path</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;file_path&#39;</span><span class="p">]</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output_path&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">/</span> <span class="s1">&#39;snap_processed&#39;</span>
        <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">preprocessing_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;preprocessing_chain&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;calibration&#39;</span><span class="p">])</span>

        <span class="n">current_file</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="n">processed_files</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">process_name</span> <span class="ow">in</span> <span class="n">preprocessing_chain</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">process_name</span><span class="si">}</span><span class="s2">.dim&quot;</span>

                <span class="k">if</span> <span class="n">process_name</span> <span class="o">==</span> <span class="s1">&#39;calibration&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gpt</span><span class="o">.</span><span class="n">calibration</span><span class="p">(</span><span class="n">current_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_file</span><span class="p">),</span>
                                       <span class="n">outputSigmaBand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">process_name</span> <span class="o">==</span> <span class="s1">&#39;terrain_correction&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gpt</span><span class="o">.</span><span class="n">terrain_correction</span><span class="p">(</span><span class="n">current_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_file</span><span class="p">),</span>
                                              <span class="n">demName</span><span class="o">=</span><span class="s1">&#39;SRTM 3Sec&#39;</span><span class="p">,</span>
                                              <span class="n">pixelSpacingInMeter</span><span class="o">=</span><span class="mf">20.0</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">process_name</span> <span class="o">==</span> <span class="s1">&#39;speckle_filter&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gpt</span><span class="o">.</span><span class="n">speckle_filter</span><span class="p">(</span><span class="n">current_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_file</span><span class="p">),</span>
                                          <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;Lee&#39;</span><span class="p">,</span>
                                          <span class="n">filterSizeX</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                          <span class="n">filterSizeY</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown preprocessing step: </span><span class="si">{</span><span class="n">process_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">current_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
                <span class="n">processed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">process_name</span><span class="p">,</span> <span class="n">current_file</span><span class="p">))</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SNAP </span><span class="si">{</span><span class="n">process_name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;continue_on_snap_error&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="k">raise</span>

        <span class="c1"># Update input data with preprocessed file</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">processed_files</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;file_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_files</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Use last processed file</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;preprocessing_applied&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processed_files</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;processed_files&#39;</span><span class="p">:</span> <span class="n">processed_files</span><span class="p">,</span>
            <span class="s1">&#39;final_file&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;file_path&#39;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SLADecompositionStep</span><span class="p">(</span><span class="n">ProcessingStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sub-look analysis decomposition step&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;SLA Decomposition&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform SLA decomposition&quot;&quot;&quot;</span>

        <span class="n">sla_processor</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sla_processor&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sla_processor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Reload data if processor not available</span>
            <span class="n">sla_processor</span> <span class="o">=</span> <span class="n">SubLookAnalysis</span><span class="p">()</span>
            <span class="n">sla_processor</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;file_path&#39;</span><span class="p">],</span> 
                                  <span class="n">band_name</span><span class="o">=</span><span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;band_name&#39;</span><span class="p">])</span>

        <span class="c1"># Configure SLA parameters</span>
        <span class="n">num_looks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;num_looks&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">overlap_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overlap_factor&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">window_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;window_function&#39;</span><span class="p">,</span> <span class="s1">&#39;hann&#39;</span><span class="p">)</span>

        <span class="n">sla_processor</span><span class="o">.</span><span class="n">set_sublook_parameters</span><span class="p">(</span>
            <span class="n">num_looks</span><span class="o">=</span><span class="n">num_looks</span><span class="p">,</span>
            <span class="n">overlap_factor</span><span class="o">=</span><span class="n">overlap_factor</span>
        <span class="p">)</span>

        <span class="c1"># Perform decomposition</span>
        <span class="n">sla_processor</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>

        <span class="c1"># Get results</span>
        <span class="n">sublooks</span> <span class="o">=</span> <span class="n">sla_processor</span><span class="o">.</span><span class="n">get_sublooks</span><span class="p">()</span>
        <span class="n">master_image</span> <span class="o">=</span> <span class="n">sla_processor</span><span class="o">.</span><span class="n">get_master_image</span><span class="p">()</span>
        <span class="n">coherence</span> <span class="o">=</span> <span class="n">sla_processor</span><span class="o">.</span><span class="n">get_coherence_matrix</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;sublooks&#39;</span><span class="p">:</span> <span class="n">sublooks</span><span class="p">,</span>
            <span class="s1">&#39;master_image&#39;</span><span class="p">:</span> <span class="n">master_image</span><span class="p">,</span>
            <span class="s1">&#39;coherence&#39;</span><span class="p">:</span> <span class="n">coherence</span><span class="p">,</span>
            <span class="s1">&#39;num_sublooks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">sublooks</span><span class="p">),</span>
            <span class="s1">&#39;sla_parameters&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;num_looks&#39;</span><span class="p">:</span> <span class="n">num_looks</span><span class="p">,</span>
                <span class="s1">&#39;overlap_factor&#39;</span><span class="p">:</span> <span class="n">overlap_factor</span><span class="p">,</span>
                <span class="s1">&#39;window_function&#39;</span><span class="p">:</span> <span class="n">window_function</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># Update input data</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;sla_processor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sla_processor</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="k">class</span><span class="w"> </span><span class="nc">VegetationAnalysisStep</span><span class="p">(</span><span class="n">ProcessingStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vegetation index calculation step&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Vegetation Analysis&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate vegetation indices&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enable_vegetation_analysis&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">input_data</span>

        <span class="c1"># Check if we have dual-pol data</span>
        <span class="n">required_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;indices&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;RVI&#39;</span><span class="p">])</span>
        <span class="n">vegetation_results</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># For single pol, use master image intensity</span>
            <span class="k">if</span> <span class="s1">&#39;master_image&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
                <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;master_image&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>

                <span class="c1"># Simple intensity-based indices (if single pol)</span>
                <span class="k">if</span> <span class="s1">&#39;intensity_statistics&#39;</span> <span class="ow">in</span> <span class="n">required_indices</span><span class="p">:</span>
                    <span class="n">vegetation_results</span><span class="p">[</span><span class="s1">&#39;intensity_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>
                    <span class="n">vegetation_results</span><span class="p">[</span><span class="s1">&#39;intensity_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>
                    <span class="n">vegetation_results</span><span class="p">[</span><span class="s1">&#39;intensity_cv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>

            <span class="c1"># For dual-pol data (if available)</span>
            <span class="k">if</span> <span class="s1">&#39;vv_intensity&#39;</span> <span class="ow">in</span> <span class="n">input_data</span> <span class="ow">and</span> <span class="s1">&#39;vh_intensity&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
                <span class="n">vv_intensity</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;vv_intensity&#39;</span><span class="p">]</span>
                <span class="n">vh_intensity</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;vh_intensity&#39;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">index_name</span> <span class="ow">in</span> <span class="n">required_indices</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">index_name</span> <span class="o">==</span> <span class="s1">&#39;RVI&#39;</span><span class="p">:</span>
                        <span class="n">vegetation_results</span><span class="p">[</span><span class="s1">&#39;RVI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RVI</span><span class="p">(</span><span class="n">vh_intensity</span><span class="p">,</span> <span class="n">vv_intensity</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">index_name</span> <span class="o">==</span> <span class="s1">&#39;NDPoll&#39;</span><span class="p">:</span>
                        <span class="n">vegetation_results</span><span class="p">[</span><span class="s1">&#39;NDPoll&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NDPoll</span><span class="p">(</span><span class="n">vh_intensity</span><span class="p">,</span> <span class="n">vv_intensity</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">index_name</span> <span class="o">==</span> <span class="s1">&#39;DPDD&#39;</span><span class="p">:</span>
                        <span class="n">vegetation_results</span><span class="p">[</span><span class="s1">&#39;DPDD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DPDD</span><span class="p">(</span><span class="n">vh_intensity</span><span class="p">,</span> <span class="n">vv_intensity</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">vegetation_results</span>

            <span class="c1"># Update input data</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;vegetation_indices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vegetation_results</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vegetation analysis failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">input_data</span>

<span class="k">class</span><span class="w"> </span><span class="nc">QualityAssessmentStep</span><span class="p">(</span><span class="n">ProcessingStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Quality assessment and metrics calculation step&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Quality Assessment&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assess processing quality&quot;&quot;&quot;</span>

        <span class="n">quality_metrics</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># SLA quality metrics</span>
        <span class="k">if</span> <span class="s1">&#39;sublooks&#39;</span> <span class="ow">in</span> <span class="n">input_data</span> <span class="ow">and</span> <span class="s1">&#39;master_image&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="n">sublooks</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;sublooks&#39;</span><span class="p">]</span>
            <span class="n">master_image</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;master_image&#39;</span><span class="p">]</span>

            <span class="c1"># Calculate SNR for sublooks</span>
            <span class="n">snr_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sublook</span> <span class="ow">in</span> <span class="n">sublooks</span><span class="p">:</span>
                <span class="n">signal_power</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sublook</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">noise_floor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sublook</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                <span class="n">snr_db</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">signal_power</span> <span class="o">/</span> <span class="p">(</span><span class="n">noise_floor</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">))</span>
                <span class="n">snr_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snr_db</span><span class="p">)</span>

            <span class="n">quality_metrics</span><span class="p">[</span><span class="s1">&#39;snr_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">snr_values</span><span class="p">)</span>
            <span class="n">quality_metrics</span><span class="p">[</span><span class="s1">&#39;snr_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">snr_values</span><span class="p">)</span>

            <span class="c1"># Speckle reduction assessment</span>
            <span class="n">master_speckle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">master_image</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">master_image</span><span class="p">))</span>
            <span class="n">sublook_speckles</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sl</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sl</span><span class="p">))</span> <span class="k">for</span> <span class="n">sl</span> <span class="ow">in</span> <span class="n">sublooks</span><span class="p">]</span>
            <span class="n">mean_sublook_speckle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sublook_speckles</span><span class="p">)</span>

            <span class="n">quality_metrics</span><span class="p">[</span><span class="s1">&#39;speckle_reduction_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">master_speckle</span> <span class="o">/</span> <span class="p">(</span><span class="n">mean_sublook_speckle</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
            <span class="n">quality_metrics</span><span class="p">[</span><span class="s1">&#39;master_speckle_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">master_speckle</span>

            <span class="c1"># Coherence analysis</span>
            <span class="k">if</span> <span class="s1">&#39;coherence&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
                <span class="n">coherence</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;coherence&#39;</span><span class="p">]</span>
                <span class="n">quality_metrics</span><span class="p">[</span><span class="s1">&#39;mean_coherence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coherence</span><span class="p">))</span>
                <span class="n">quality_metrics</span><span class="p">[</span><span class="s1">&#39;coherence_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coherence</span><span class="p">))</span>

        <span class="c1"># Data quality checks</span>
        <span class="k">if</span> <span class="s1">&#39;master_image&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;master_image&#39;</span><span class="p">]</span>
            <span class="n">quality_metrics</span><span class="p">[</span><span class="s1">&#39;data_range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">master</span><span class="p">))),</span> 
                                           <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">master</span><span class="p">)))]</span>
            <span class="n">quality_metrics</span><span class="p">[</span><span class="s1">&#39;data_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">master</span><span class="p">)))</span>
            <span class="n">quality_metrics</span><span class="p">[</span><span class="s1">&#39;nan_pixels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">master</span><span class="p">)))</span>
            <span class="n">quality_metrics</span><span class="p">[</span><span class="s1">&#39;inf_pixels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">master</span><span class="p">)))</span>

        <span class="c1"># Quality flags</span>
        <span class="n">quality_flags</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;good_snr&#39;</span><span class="p">:</span> <span class="n">quality_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;snr_mean&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s1">&#39;good_speckle_reduction&#39;</span><span class="p">:</span> <span class="n">quality_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;speckle_reduction_factor&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="p">,</span>
            <span class="s1">&#39;good_coherence&#39;</span><span class="p">:</span> <span class="n">quality_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mean_coherence&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">,</span>
            <span class="s1">&#39;no_invalid_data&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">quality_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nan_pixels&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> 
                              <span class="n">quality_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;inf_pixels&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">quality_metrics</span><span class="p">[</span><span class="s1">&#39;quality_flags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">quality_flags</span>
        <span class="n">quality_metrics</span><span class="p">[</span><span class="s1">&#39;overall_quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">quality_flags</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">quality_metrics</span>

        <span class="c1"># Update input data</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;quality_metrics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">quality_metrics</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing steps implemented&quot;</span><span class="p">)</span>
</code></pre>
<h2 id="3-application-specific-workflow-examples">3. Application-Specific Workflow Examples</h2>
<h3 id="31-forest-monitoring-workflow">3.1 Forest Monitoring Workflow</h3>
<pre class="codehilite"><code><span class="k">def</span><span class="w"> </span><span class="nf">create_forest_monitoring_workflow</span><span class="p">(</span><span class="n">input_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CustomWorkflow</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create workflow optimized for forest monitoring&quot;&quot;&quot;</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">ProcessingConfig</span><span class="p">(</span>
        <span class="n">input_path</span><span class="o">=</span><span class="n">input_path</span><span class="p">,</span>
        <span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span>
        <span class="n">band_name</span><span class="o">=</span><span class="s1">&#39;Sigma0_VV_slc&#39;</span><span class="p">,</span>
        <span class="n">num_looks</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>  <span class="c1"># Higher number of looks for better statistics</span>
        <span class="n">overlap_factor</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>  <span class="c1"># Lower overlap for independence</span>
        <span class="n">snap_processing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">generate_vegetation_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">perform_decomposition</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">quality_assessment</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">CustomWorkflow</span><span class="p">(</span><span class="s2">&quot;Forest Monitoring&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="c1"># Step 1: Load data</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">DataLoadingStep</span><span class="p">({</span>
        <span class="s1">&#39;band_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Sigma0_VV_slc&#39;</span>
    <span class="p">}))</span>

    <span class="c1"># Step 2: SNAP preprocessing</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">SNAPPreprocessingStep</span><span class="p">({</span>
        <span class="s1">&#39;enable_snap&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;preprocessing_chain&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;calibration&#39;</span><span class="p">,</span> <span class="s1">&#39;terrain_correction&#39;</span><span class="p">],</span>
        <span class="s1">&#39;output_path&#39;</span><span class="p">:</span> <span class="n">output_path</span><span class="p">,</span>
        <span class="s1">&#39;continue_on_snap_error&#39;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}))</span>

    <span class="c1"># Step 3: SLA decomposition</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">SLADecompositionStep</span><span class="p">({</span>
        <span class="s1">&#39;num_looks&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s1">&#39;overlap_factor&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="s1">&#39;window_function&#39;</span><span class="p">:</span> <span class="s1">&#39;hann&#39;</span>
    <span class="p">}))</span>

    <span class="c1"># Step 4: Forest-specific vegetation analysis</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">VegetationAnalysisStep</span><span class="p">({</span>
        <span class="s1">&#39;enable_vegetation_analysis&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;indices&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;intensity_statistics&#39;</span><span class="p">]</span>  <span class="c1"># Will add more for dual-pol</span>
    <span class="p">}))</span>

    <span class="c1"># Step 5: Quality assessment</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">QualityAssessmentStep</span><span class="p">({}))</span>

    <span class="k">return</span> <span class="n">workflow</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ForestMetricsStep</span><span class="p">(</span><span class="n">ProcessingStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Forest-specific metrics calculation&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Forest Metrics&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate forest-specific metrics&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;sublooks&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;SLA decomposition required for forest metrics&quot;</span><span class="p">)</span>

        <span class="n">sublooks</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;sublooks&#39;</span><span class="p">]</span>
        <span class="n">master_image</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;master_image&#39;</span><span class="p">]</span>

        <span class="c1"># Forest canopy roughness (texture analysis)</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">master_image</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

        <span class="c1"># Local variance (texture measure)</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ndimage</span>
        <span class="n">local_variance</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">generic_filter</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

        <span class="c1"># Forest height proxy (using SLA temporal decorrelation)</span>
        <span class="k">if</span> <span class="s1">&#39;coherence&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="n">coherence</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;coherence&#39;</span><span class="p">]</span>
            <span class="n">mean_coherence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coherence</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Forest height estimation (simplified)</span>
            <span class="c1"># Lower coherence often indicates taller vegetation</span>
            <span class="n">forest_height_proxy</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mean_coherence</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">forest_height_proxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>

        <span class="c1"># Biomass proxy using backscatter variation</span>
        <span class="n">biomass_proxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">intensity</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>

        <span class="c1"># Forest density estimation</span>
        <span class="n">sublook_variability</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sublook</span> <span class="ow">in</span> <span class="n">sublooks</span><span class="p">:</span>
            <span class="n">sl_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sublook</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">variability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">sl_intensity</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">sublook_variability</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variability</span><span class="p">)</span>

        <span class="n">forest_density_proxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sublook_variability</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">forest_metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;canopy_roughness&#39;</span><span class="p">:</span> <span class="n">local_variance</span><span class="p">,</span>
            <span class="s1">&#39;height_proxy&#39;</span><span class="p">:</span> <span class="n">forest_height_proxy</span><span class="p">,</span>
            <span class="s1">&#39;biomass_proxy&#39;</span><span class="p">:</span> <span class="n">biomass_proxy</span><span class="p">,</span>
            <span class="s1">&#39;density_proxy&#39;</span><span class="p">:</span> <span class="n">forest_density_proxy</span><span class="p">,</span>
            <span class="s1">&#39;statistics&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;mean_roughness&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">local_variance</span><span class="p">),</span>
                <span class="s1">&#39;mean_height_proxy&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">forest_height_proxy</span><span class="p">),</span>
                <span class="s1">&#39;mean_biomass_proxy&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">biomass_proxy</span><span class="p">),</span>
                <span class="s1">&#39;mean_density_proxy&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">forest_density_proxy</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">forest_metrics</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;forest_metrics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">forest_metrics</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="c1"># Example usage</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating forest monitoring workflow...&quot;</span><span class="p">)</span>
<span class="n">forest_workflow</span> <span class="o">=</span> <span class="n">create_forest_monitoring_workflow</span><span class="p">(</span>
    <span class="s2">&quot;path/to/forest_data.dim&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/forest_analysis&quot;</span>
<span class="p">)</span>

<span class="c1"># Add forest-specific metrics step</span>
<span class="n">forest_workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">ForestMetricsStep</span><span class="p">({}))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Forest workflow created with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">forest_workflow</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span><span class="si">}</span><span class="s2"> steps&quot;</span><span class="p">)</span>
</code></pre>
<h3 id="32-urban-monitoring-workflow">3.2 Urban Monitoring Workflow</h3>
<pre class="codehilite"><code><span class="k">def</span><span class="w"> </span><span class="nf">create_urban_monitoring_workflow</span><span class="p">(</span><span class="n">input_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CustomWorkflow</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create workflow optimized for urban area monitoring&quot;&quot;&quot;</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">ProcessingConfig</span><span class="p">(</span>
        <span class="n">input_path</span><span class="o">=</span><span class="n">input_path</span><span class="p">,</span>
        <span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span>
        <span class="n">band_name</span><span class="o">=</span><span class="s1">&#39;Sigma0_VV_slc&#39;</span><span class="p">,</span>
        <span class="n">num_looks</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># Lower for preserving urban detail</span>
        <span class="n">overlap_factor</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>  <span class="c1"># Higher overlap for better resolution</span>
        <span class="n">snap_processing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">quality_assessment</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">CustomWorkflow</span><span class="p">(</span><span class="s2">&quot;Urban Monitoring&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="c1"># Standard steps</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">DataLoadingStep</span><span class="p">({</span><span class="s1">&#39;band_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Sigma0_VV_slc&#39;</span><span class="p">}))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">SNAPPreprocessingStep</span><span class="p">({</span>
        <span class="s1">&#39;enable_snap&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;preprocessing_chain&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;calibration&#39;</span><span class="p">,</span> <span class="s1">&#39;terrain_correction&#39;</span><span class="p">],</span>
        <span class="s1">&#39;output_path&#39;</span><span class="p">:</span> <span class="n">output_path</span>
    <span class="p">}))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">SLADecompositionStep</span><span class="p">({</span>
        <span class="s1">&#39;num_looks&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s1">&#39;overlap_factor&#39;</span><span class="p">:</span> <span class="mf">0.6</span>
    <span class="p">}))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">QualityAssessmentStep</span><span class="p">({}))</span>

    <span class="k">return</span> <span class="n">workflow</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UrbanFeatureExtractionStep</span><span class="p">(</span><span class="n">ProcessingStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Urban feature extraction step&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Urban Feature Extraction&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract urban features from SAR data&quot;&quot;&quot;</span>

        <span class="n">master_image</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;master_image&#39;</span><span class="p">]</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">master_image</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

        <span class="c1"># Building detection using high backscatter areas</span>
        <span class="n">intensity_db</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">intensity</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
        <span class="n">building_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">intensity_db</span><span class="p">,</span> <span class="mi">85</span><span class="p">)</span>  <span class="c1"># Top 15%</span>
        <span class="n">building_mask</span> <span class="o">=</span> <span class="n">intensity_db</span> <span class="o">&gt;</span> <span class="n">building_threshold</span>

        <span class="c1"># Road detection using local orientation analysis</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ndimage</span>

        <span class="c1"># Gradient-based edge detection</span>
        <span class="n">grad_x</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">intensity_db</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">grad_y</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">intensity_db</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">gradient_magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">grad_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">grad_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Linear feature enhancement (roads, railways)</span>
        <span class="n">road_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">gradient_magnitude</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
        <span class="n">linear_features</span> <span class="o">=</span> <span class="n">gradient_magnitude</span> <span class="o">&gt;</span> <span class="n">road_threshold</span>

        <span class="c1"># Urban texture analysis</span>
        <span class="n">texture_window_size</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="n">local_std</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">generic_filter</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">texture_window_size</span><span class="p">)</span>

        <span class="c1"># Urban density estimation</span>
        <span class="n">urban_density</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">uniform_filter</span><span class="p">(</span><span class="n">building_mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>

        <span class="n">urban_features</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;building_mask&#39;</span><span class="p">:</span> <span class="n">building_mask</span><span class="p">,</span>
            <span class="s1">&#39;linear_features&#39;</span><span class="p">:</span> <span class="n">linear_features</span><span class="p">,</span>
            <span class="s1">&#39;urban_density&#39;</span><span class="p">:</span> <span class="n">urban_density</span><span class="p">,</span>
            <span class="s1">&#39;texture_map&#39;</span><span class="p">:</span> <span class="n">local_std</span><span class="p">,</span>
            <span class="s1">&#39;intensity_db&#39;</span><span class="p">:</span> <span class="n">intensity_db</span><span class="p">,</span>
            <span class="s1">&#39;statistics&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;building_percentage&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">building_mask</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                <span class="s1">&#39;linear_feature_percentage&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">linear_features</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                <span class="s1">&#39;mean_urban_density&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">urban_density</span><span class="p">),</span>
                <span class="s1">&#39;mean_texture&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">local_std</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">urban_features</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;urban_features&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">urban_features</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="c1"># Create urban monitoring workflow</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating urban monitoring workflow...&quot;</span><span class="p">)</span>
<span class="n">urban_workflow</span> <span class="o">=</span> <span class="n">create_urban_monitoring_workflow</span><span class="p">(</span>
    <span class="s2">&quot;path/to/urban_data.dim&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/urban_analysis&quot;</span>
<span class="p">)</span>

<span class="n">urban_workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">UrbanFeatureExtractionStep</span><span class="p">({}))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Urban workflow created with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">urban_workflow</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span><span class="si">}</span><span class="s2"> steps&quot;</span><span class="p">)</span>
</code></pre>
<h3 id="33-agricultural-monitoring-workflow">3.3 Agricultural Monitoring Workflow</h3>
<pre class="codehilite"><code><span class="k">def</span><span class="w"> </span><span class="nf">create_agriculture_workflow</span><span class="p">(</span><span class="n">input_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CustomWorkflow</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create workflow for agricultural monitoring&quot;&quot;&quot;</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">ProcessingConfig</span><span class="p">(</span>
        <span class="n">input_path</span><span class="o">=</span><span class="n">input_path</span><span class="p">,</span>
        <span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span>
        <span class="n">band_name</span><span class="o">=</span><span class="s1">&#39;Sigma0_VV_slc&#39;</span><span class="p">,</span>
        <span class="n">num_looks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">overlap_factor</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
        <span class="n">snap_processing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">generate_vegetation_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">quality_assessment</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">CustomWorkflow</span><span class="p">(</span><span class="s2">&quot;Agricultural Monitoring&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="c1"># Standard processing steps</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">DataLoadingStep</span><span class="p">({</span><span class="s1">&#39;band_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Sigma0_VV_slc&#39;</span><span class="p">}))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">SNAPPreprocessingStep</span><span class="p">({</span>
        <span class="s1">&#39;enable_snap&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;preprocessing_chain&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;calibration&#39;</span><span class="p">,</span> <span class="s1">&#39;speckle_filter&#39;</span><span class="p">,</span> <span class="s1">&#39;terrain_correction&#39;</span><span class="p">],</span>
        <span class="s1">&#39;output_path&#39;</span><span class="p">:</span> <span class="n">output_path</span>
    <span class="p">}))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">SLADecompositionStep</span><span class="p">({</span>
        <span class="s1">&#39;num_looks&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">&#39;overlap_factor&#39;</span><span class="p">:</span> <span class="mf">0.4</span>
    <span class="p">}))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">VegetationAnalysisStep</span><span class="p">({</span>
        <span class="s1">&#39;enable_vegetation_analysis&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;indices&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;intensity_statistics&#39;</span><span class="p">]</span>
    <span class="p">}))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">QualityAssessmentStep</span><span class="p">({}))</span>

    <span class="k">return</span> <span class="n">workflow</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CropAnalysisStep</span><span class="p">(</span><span class="n">ProcessingStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Agricultural crop analysis step&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Crop Analysis&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze agricultural crops using SAR data&quot;&quot;&quot;</span>

        <span class="n">master_image</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;master_image&#39;</span><span class="p">]</span>
        <span class="n">sublooks</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;sublooks&#39;</span><span class="p">]</span>

        <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">master_image</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">intensity_db</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">intensity</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>

        <span class="c1"># Crop field segmentation using texture</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ndimage</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">KMeans</span>

        <span class="c1"># Calculate texture features</span>
        <span class="n">window_size</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">mean_filter</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">uniform_filter</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span>
        <span class="n">variance_filter</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">generic_filter</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">window_size</span><span class="p">)</span>

        <span class="c1"># Feature vector for segmentation</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span>
            <span class="n">intensity_db</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">mean_filter</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">variance_filter</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># K-means clustering for field segmentation</span>
        <span class="n">n_clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n_crop_classes&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="n">field_labels</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="n">field_map</span> <span class="o">=</span> <span class="n">field_labels</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">intensity</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># Crop phenology indicators</span>
        <span class="c1"># Temporal coherence as crop development indicator</span>
        <span class="k">if</span> <span class="s1">&#39;coherence&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="n">coherence</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;coherence&#39;</span><span class="p">]</span>
            <span class="n">mean_coherence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coherence</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">crop_development</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mean_coherence</span>  <span class="c1"># Low coherence = high development</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">crop_development</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>

        <span class="c1"># Crop moisture estimation using cross-pol ratio (if available)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sublooks</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Use sublook variation as moisture proxy</span>
            <span class="n">sublook_variation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sl</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">sl</span> <span class="ow">in</span> <span class="n">sublooks</span><span class="p">[:</span><span class="mi">4</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">moisture_proxy</span> <span class="o">=</span> <span class="n">sublook_variation</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sl</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">sl</span> <span class="ow">in</span> <span class="n">sublooks</span><span class="p">[:</span><span class="mi">4</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">moisture_proxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>

        <span class="c1"># Calculate field statistics</span>
        <span class="n">field_stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_clusters</span><span class="p">):</span>
            <span class="n">field_mask</span> <span class="o">=</span> <span class="n">field_map</span> <span class="o">==</span> <span class="n">field_id</span>
            <span class="n">field_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">field_mask</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">field_area</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>  <span class="c1"># Minimum field size</span>
                <span class="n">field_stats</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;field_</span><span class="si">{</span><span class="n">field_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;area_pixels&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">field_area</span><span class="p">),</span>
                    <span class="s1">&#39;mean_intensity_db&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">intensity_db</span><span class="p">[</span><span class="n">field_mask</span><span class="p">])),</span>
                    <span class="s1">&#39;std_intensity_db&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">intensity_db</span><span class="p">[</span><span class="n">field_mask</span><span class="p">])),</span>
                    <span class="s1">&#39;mean_development&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">crop_development</span><span class="p">[</span><span class="n">field_mask</span><span class="p">])),</span>
                    <span class="s1">&#39;mean_moisture_proxy&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">moisture_proxy</span><span class="p">[</span><span class="n">field_mask</span><span class="p">]))</span>
                <span class="p">}</span>

        <span class="n">crop_analysis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;field_map&#39;</span><span class="p">:</span> <span class="n">field_map</span><span class="p">,</span>
            <span class="s1">&#39;crop_development&#39;</span><span class="p">:</span> <span class="n">crop_development</span><span class="p">,</span>
            <span class="s1">&#39;moisture_proxy&#39;</span><span class="p">:</span> <span class="n">moisture_proxy</span><span class="p">,</span>
            <span class="s1">&#39;texture_variance&#39;</span><span class="p">:</span> <span class="n">variance_filter</span><span class="p">,</span>
            <span class="s1">&#39;field_statistics&#39;</span><span class="p">:</span> <span class="n">field_stats</span><span class="p">,</span>
            <span class="s1">&#39;n_fields_detected&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">field_stats</span><span class="p">),</span>
            <span class="s1">&#39;statistics&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;mean_development&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">crop_development</span><span class="p">),</span>
                <span class="s1">&#39;mean_moisture&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">moisture_proxy</span><span class="p">),</span>
                <span class="s1">&#39;total_agricultural_area&#39;</span><span class="p">:</span> <span class="n">intensity</span><span class="o">.</span><span class="n">size</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">crop_analysis</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;crop_analysis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_analysis</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="c1"># Create agricultural workflow</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating agricultural monitoring workflow...&quot;</span><span class="p">)</span>
<span class="n">agriculture_workflow</span> <span class="o">=</span> <span class="n">create_agriculture_workflow</span><span class="p">(</span>
    <span class="s2">&quot;path/to/agriculture_data.dim&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/agriculture_analysis&quot;</span>
<span class="p">)</span>

<span class="n">agriculture_workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">CropAnalysisStep</span><span class="p">({</span><span class="s1">&#39;n_crop_classes&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Agricultural workflow created with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">agriculture_workflow</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span><span class="si">}</span><span class="s2"> steps&quot;</span><span class="p">)</span>
</code></pre>
<h2 id="4-workflow-optimization-and-performance">4. Workflow Optimization and Performance</h2>
<h3 id="41-performance-optimization-step">4.1 Performance Optimization Step</h3>
<pre class="codehilite"><code><span class="k">class</span><span class="w"> </span><span class="nc">PerformanceOptimizationStep</span><span class="p">(</span><span class="n">ProcessingStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optimize processing performance&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Performance Optimization&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply performance optimizations&quot;&quot;&quot;</span>

        <span class="n">optimization_applied</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Memory optimization</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enable_memory_optimization&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="c1"># Process data in chunks if large</span>
            <span class="k">if</span> <span class="s1">&#39;master_image&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
                <span class="n">master</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;master_image&#39;</span><span class="p">]</span>
                <span class="n">memory_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;memory_threshold_mb&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
                <span class="n">current_memory_mb</span> <span class="o">=</span> <span class="n">master</span><span class="o">.</span><span class="n">nbytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">current_memory_mb</span> <span class="o">&gt;</span> <span class="n">memory_threshold</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Large dataset detected (</span><span class="si">{</span><span class="n">current_memory_mb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB), applying memory optimization&quot;</span><span class="p">)</span>

                    <span class="c1"># Implement chunked processing (placeholder)</span>
                    <span class="n">chunk_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
                    <span class="n">optimization_applied</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;memory_chunking&#39;</span><span class="p">)</span>

        <span class="c1"># Parallel processing optimization</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enable_parallel_processing&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span>
            <span class="n">n_cores</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_cores&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">optimization_applied</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;parallel_processing_</span><span class="si">{</span><span class="n">n_cores</span><span class="si">}</span><span class="s1">_cores&#39;</span><span class="p">)</span>

        <span class="c1"># Cache optimization</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enable_caching&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">cache_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cache_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;cache&#39;</span><span class="p">))</span>
            <span class="n">cache_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">optimization_applied</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;result_caching&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;optimizations_applied&#39;</span><span class="p">:</span> <span class="n">optimization_applied</span><span class="p">,</span>
            <span class="s1">&#39;performance_config&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
        <span class="p">}</span>

        <span class="c1"># Performance doesn&#39;t modify data, just logs optimizations</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;performance_optimizations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ErrorHandlingStep</span><span class="p">(</span><span class="n">ProcessingStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Robust error handling and recovery&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Error Handling&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply error handling and data validation&quot;&quot;&quot;</span>

        <span class="n">validation_results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data_valid&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;warnings&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;corrections_applied&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="c1"># Check for NaN/Inf values</span>
        <span class="k">if</span> <span class="s1">&#39;master_image&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;master_image&#39;</span><span class="p">]</span>

            <span class="n">nan_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">master</span><span class="p">))</span>
            <span class="n">inf_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">master</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">nan_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;warnings&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">nan_count</span><span class="si">}</span><span class="s2"> NaN values&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;replace_nan&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="c1"># Replace NaN with median value</span>
                    <span class="n">median_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
                    <span class="n">master</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">master</span><span class="p">),</span> <span class="n">median_val</span><span class="p">,</span> <span class="n">master</span><span class="p">)</span>
                    <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;master_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">master</span>
                    <span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;corrections_applied&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nan_replacement&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">inf_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;warnings&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">inf_count</span><span class="si">}</span><span class="s2"> infinite values&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;replace_inf&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="c1"># Replace Inf with maximum finite value</span>
                    <span class="n">finite_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">finite_mask</span><span class="p">):</span>
                        <span class="n">max_finite</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="n">finite_mask</span><span class="p">])</span>
                        <span class="n">master</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">master</span><span class="p">),</span> <span class="n">max_finite</span><span class="p">,</span> <span class="n">master</span><span class="p">)</span>
                        <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;master_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">master</span>
                        <span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;corrections_applied&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;inf_replacement&#39;</span><span class="p">)</span>

        <span class="c1"># Validate data ranges</span>
        <span class="k">if</span> <span class="s1">&#39;master_image&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;master_image&#39;</span><span class="p">]</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">master</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

            <span class="c1"># Check for reasonable intensity values</span>
            <span class="n">min_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>
            <span class="n">max_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">min_intensity</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;warnings&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Found zero or negative intensities&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">max_intensity</span> <span class="o">&gt;</span> <span class="mf">1e10</span><span class="p">:</span>
                <span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;warnings&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Found extremely high intensity values&quot;</span><span class="p">)</span>
                <span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;data_valid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Validate SLA results</span>
        <span class="k">if</span> <span class="s1">&#39;sublooks&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="n">sublooks</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;sublooks&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sublooks</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Insufficient number of sub-looks&quot;</span><span class="p">)</span>
                <span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;data_valid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Check sublook consistency</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">sl</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">sl</span> <span class="ow">in</span> <span class="n">sublooks</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">shape</span> <span class="o">==</span> <span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">):</span>
                <span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Inconsistent sub-look dimensions&quot;</span><span class="p">)</span>
                <span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;data_valid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">validation_results</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;validation_results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">validation_results</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;data_valid&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data validation failed: </span><span class="si">{</span><span class="n">validation_results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performance optimization and error handling steps implemented&quot;</span><span class="p">)</span>
</code></pre>
<h3 id="42-workflow-manager-with-advanced-features">4.2 Workflow Manager with Advanced Features</h3>
<pre class="codehilite"><code><span class="k">class</span><span class="w"> </span><span class="nc">AdvancedWorkflowManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Advanced workflow manager with caching, parallel processing, and monitoring&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;workflow_cache&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workflows</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_history</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow</span><span class="p">:</span> <span class="n">CustomWorkflow</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a workflow for management&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="p">[</span><span class="n">workflow</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">workflow</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Registered workflow: </span><span class="si">{</span><span class="n">workflow</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                        <span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute workflow with advanced features&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">workflow_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Workflow &#39;</span><span class="si">{</span><span class="n">workflow_name</span><span class="si">}</span><span class="s2">&#39; not registered&quot;</span><span class="p">)</span>

        <span class="n">workflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="p">[</span><span class="n">workflow_name</span><span class="p">]</span>

        <span class="c1"># Check cache</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_cache_key</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">,</span> <span class="n">input_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
            <span class="n">cached_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_cache</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cached_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded workflow &#39;</span><span class="si">{</span><span class="n">workflow_name</span><span class="si">}</span><span class="s2">&#39; result from cache&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">cached_result</span>

        <span class="c1"># Execute workflow</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
            <span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

            <span class="c1"># Save to cache</span>
            <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_cache</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

            <span class="c1"># Record execution</span>
            <span class="n">execution_record</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;workflow_name&#39;</span><span class="p">:</span> <span class="n">workflow_name</span><span class="p">,</span>
                <span class="s1">&#39;execution_time&#39;</span><span class="p">:</span> <span class="n">execution_time</span><span class="p">,</span>
                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;cache_used&#39;</span><span class="p">:</span> <span class="kc">False</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">execution_record</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">execution_record</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;workflow_name&#39;</span><span class="p">:</span> <span class="n">workflow_name</span><span class="p">,</span>
                <span class="s1">&#39;execution_time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span>
                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="s1">&#39;cache_used&#39;</span><span class="p">:</span> <span class="kc">False</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">execution_record</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate cache key for workflow execution&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>

        <span class="c1"># Create hash from workflow name and input characteristics</span>
        <span class="n">key_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">workflow_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">key_data</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">key_data</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load result from cache&quot;&quot;&quot;</span>
        <span class="n">cache_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cache_key</span><span class="si">}</span><span class="s2">.json&quot;</span>
        <span class="k">if</span> <span class="n">cache_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load cache: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_to_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save result to cache&quot;&quot;&quot;</span>
        <span class="n">cache_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cache_key</span><span class="si">}</span><span class="s2">.json&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Convert numpy arrays to lists for JSON serialization</span>
            <span class="n">serializable_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_serializable</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">serializable_result</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save cache: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_serializable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert object to JSON-serializable format&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;__numpy_array__&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span> <span class="s1">&#39;shape&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_serializable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_serializable</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_execution_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get workflow execution statistics&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_history</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;No executions recorded&#39;</span><span class="p">}</span>

        <span class="n">successful_runs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_history</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]]</span>
        <span class="n">failed_runs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_history</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]]</span>

        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_executions&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_history</span><span class="p">),</span>
            <span class="s1">&#39;successful_executions&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">successful_runs</span><span class="p">),</span>
            <span class="s1">&#39;failed_executions&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed_runs</span><span class="p">),</span>
            <span class="s1">&#39;success_rate&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">successful_runs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_history</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;average_execution_time&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;execution_time&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">successful_runs</span><span class="p">])</span> <span class="k">if</span> <span class="n">successful_runs</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;workflows_executed&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;workflow_name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_history</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">stats</span>

<span class="c1"># Initialize advanced workflow manager</span>
<span class="n">workflow_manager</span> <span class="o">=</span> <span class="n">AdvancedWorkflowManager</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/workflow_cache&quot;</span><span class="p">)</span>

<span class="c1"># Register workflows</span>
<span class="n">workflow_manager</span><span class="o">.</span><span class="n">register_workflow</span><span class="p">(</span><span class="n">forest_workflow</span><span class="p">)</span>
<span class="n">workflow_manager</span><span class="o">.</span><span class="n">register_workflow</span><span class="p">(</span><span class="n">urban_workflow</span><span class="p">)</span>
<span class="n">workflow_manager</span><span class="o">.</span><span class="n">register_workflow</span><span class="p">(</span><span class="n">agriculture_workflow</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Advanced workflow manager initialized with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">workflows</span><span class="p">)</span><span class="si">}</span><span class="s2"> workflows&quot;</span><span class="p">)</span>
</code></pre>
<h2 id="5-batch-processing-and-automation">5. Batch Processing and Automation</h2>
<h3 id="51-batch-processing-framework">5.1 Batch Processing Framework</h3>
<pre class="codehilite"><code><span class="k">class</span><span class="w"> </span><span class="nc">BatchProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Batch processing framework for multiple datasets&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_manager</span><span class="p">:</span> <span class="n">AdvancedWorkflowManager</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span> <span class="o">=</span> <span class="n">workflow_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">input_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
                     <span class="n">output_base_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process multiple datasets with the same workflow&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_parallel</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">,</span> <span class="n">input_paths</span><span class="p">,</span> <span class="n">output_base_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_sequential</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">,</span> <span class="n">input_paths</span><span class="p">,</span> <span class="n">output_base_dir</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_sequential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">input_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
                          <span class="n">output_base_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sequential batch processing&quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">failed_files</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">input_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">input_paths</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">input_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Create unique output directory for each file</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
                <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_base_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">file_name</span>
                <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Update workflow configuration</span>
                <span class="n">workflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">workflows</span><span class="p">[</span><span class="n">workflow_name</span><span class="p">]</span>
                <span class="n">workflow</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">input_path</span> <span class="o">=</span> <span class="n">input_path</span>
                <span class="n">workflow</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

                <span class="c1"># Execute workflow</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">execute_workflow</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">,</span> <span class="n">input_path</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">input_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully processed: </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process </span><span class="si">{</span><span class="n">input_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">input_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>

        <span class="n">batch_summary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_files&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_paths</span><span class="p">),</span>
            <span class="s1">&#39;successful_files&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
            <span class="s1">&#39;failed_files&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed_files</span><span class="p">),</span>
            <span class="s1">&#39;success_rate&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_paths</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
            <span class="s1">&#39;failures&#39;</span><span class="p">:</span> <span class="n">failed_files</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">batch_summary</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">input_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
                         <span class="n">output_base_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parallel batch processing (simplified implementation)&quot;&quot;&quot;</span>

        <span class="c1"># For this tutorial, we&#39;ll implement a simple parallel approach</span>
        <span class="c1"># In practice, you might use multiprocessing or threading</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parallel processing not fully implemented in this tutorial&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Falling back to sequential processing&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_sequential</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">,</span> <span class="n">input_paths</span><span class="p">,</span> <span class="n">output_base_dir</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_automated_processing_script</span><span class="p">(</span><span class="n">workflow_configs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span> 
                                     <span class="n">batch_configs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create automated processing script&quot;&quot;&quot;</span>

    <span class="n">script_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;#!/usr/bin/env python3</span>
<span class="s2"># Auto-generated processing script</span>
<span class="s2"># Generated on: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span>

<span class="s2">import sys</span>
<span class="s2">import logging</span>
<span class="s2">from pathlib import Path</span>

<span class="s2"># Configure logging</span>
<span class="s2">logging.basicConfig(level=logging.INFO, </span>
<span class="s2">                   format=&#39;%(asctime)s - %(levelname)s - %(message)s&#39;,</span>
<span class="s2">                   handlers=[</span>
<span class="s2">                       logging.FileHandler(&#39;processing.log&#39;),</span>
<span class="s2">                       logging.StreamHandler(sys.stdout)</span>
<span class="s2">                   ])</span>

<span class="s2">def main():</span>
<span class="s2">    logger = logging.getLogger(__name__)</span>
<span class="s2">    logger.info(&quot;Starting automated processing&quot;)</span>

<span class="s2">    # Workflow configurations</span>
<span class="s2">    workflows = </span><span class="si">{</span><span class="n">workflow_configs</span><span class="si">}</span>

<span class="s2">    # Batch configurations  </span>
<span class="s2">    batches = </span><span class="si">{</span><span class="n">batch_configs</span><span class="si">}</span>

<span class="s2">    # Initialize workflow manager</span>
<span class="s2">    from tutorial6_custom_workflows import AdvancedWorkflowManager, BatchProcessor</span>

<span class="s2">    manager = AdvancedWorkflowManager()</span>
<span class="s2">    processor = BatchProcessor(manager)</span>

<span class="s2">    # Execute all batches</span>
<span class="s2">    for workflow_name, input_files in batches.items():</span>
<span class="s2">        if workflow_name in workflows:</span>
<span class="s2">            logger.info(f&quot;Processing batch: </span><span class="se">{{</span><span class="s2">workflow_name</span><span class="se">}}</span><span class="s2">&quot;)</span>

<span class="s2">            try:</span>
<span class="s2">                results = processor.process_batch(</span>
<span class="s2">                    workflow_name, </span>
<span class="s2">                    input_files, </span>
<span class="s2">                    f&quot;output/</span><span class="se">{{</span><span class="s2">workflow_name</span><span class="se">}}</span><span class="s2">_batch&quot;</span>
<span class="s2">                )</span>

<span class="s2">                logger.info(f&quot;Batch </span><span class="se">{{</span><span class="s2">workflow_name</span><span class="se">}}</span><span class="s2"> completed: &quot;</span>
<span class="s2">                          f&quot;</span><span class="se">{{</span><span class="s2">results[&#39;successful_files&#39;]</span><span class="se">}}</span><span class="s2">/</span><span class="se">{{</span><span class="s2">results[&#39;total_files&#39;]</span><span class="se">}}</span><span class="s2"> files processed&quot;)</span>

<span class="s2">            except Exception as e:</span>
<span class="s2">                logger.error(f&quot;Batch </span><span class="se">{{</span><span class="s2">workflow_name</span><span class="se">}}</span><span class="s2"> failed: </span><span class="se">{{</span><span class="s2">str(e)</span><span class="se">}}</span><span class="s2">&quot;)</span>

<span class="s2">    logger.info(&quot;Automated processing completed&quot;)</span>

<span class="s2">if __name__ == &quot;__main__&quot;:</span>
<span class="s2">    main()</span>
<span class="s2">&quot;&quot;&quot;</span>

    <span class="n">script_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;automated_processing.py&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">script_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">script_content</span><span class="p">)</span>

    <span class="c1"># Make script executable</span>
    <span class="n">script_path</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="mo">0o755</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">script_path</span>

<span class="c1"># Example batch processing setup</span>
<span class="n">batch_processor</span> <span class="o">=</span> <span class="n">BatchProcessor</span><span class="p">(</span><span class="n">workflow_manager</span><span class="p">)</span>

<span class="c1"># Example batch configurations</span>
<span class="n">example_batches</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Forest Monitoring&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;path/to/forest1.dim&#39;</span><span class="p">,</span>
        <span class="s1">&#39;path/to/forest2.dim&#39;</span><span class="p">,</span>
        <span class="s1">&#39;path/to/forest3.dim&#39;</span>
    <span class="p">],</span>
    <span class="s1">&#39;Urban Monitoring&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;path/to/urban1.dim&#39;</span><span class="p">,</span>
        <span class="s1">&#39;path/to/urban2.dim&#39;</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Batch processing framework implemented&quot;</span><span class="p">)</span>
</code></pre>
<h2 id="6-results-visualization-and-export">6. Results Visualization and Export</h2>
<h3 id="61-comprehensive-results-visualization">6.1 Comprehensive Results Visualization</h3>
<pre class="codehilite"><code><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowVisualizationStep</span><span class="p">(</span><span class="n">ProcessingStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate comprehensive visualizations for workflow results&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Workflow Visualization&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate comprehensive visualizations&quot;&quot;&quot;</span>

        <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output_path&#39;</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">))</span>
        <span class="n">output_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Create summary figure based on available data</span>
        <span class="n">fig_rows</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">fig_cols</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">fig_rows</span><span class="p">,</span> <span class="n">fig_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="n">plot_idx</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Master image</span>
        <span class="k">if</span> <span class="s1">&#39;master_image&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;master_image&#39;</span><span class="p">]</span>
            <span class="n">master_db</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">master</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>

            <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">master_db</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
                                     <span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">master_db</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                     <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">master_db</span><span class="p">,</span> <span class="mi">95</span><span class="p">))</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Master Image (dB)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">])</span>
            <span class="n">plot_idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Quality metrics</span>
        <span class="k">if</span> <span class="s1">&#39;quality_metrics&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="n">quality</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;quality_metrics&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s1">&#39;snr_mean&#39;</span> <span class="ow">in</span> <span class="n">quality</span><span class="p">:</span>
                <span class="c1"># SNR visualization (placeholder)</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="s1">&#39;SNR&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">quality</span><span class="p">[</span><span class="s1">&#39;snr_mean&#39;</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;SNR (dB)&#39;</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Quality Metrics</span><span class="se">\n</span><span class="s1">SNR: </span><span class="si">{</span><span class="n">quality</span><span class="p">[</span><span class="s2">&quot;snr_mean&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
                <span class="n">plot_idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Application-specific visualizations</span>
        <span class="k">if</span> <span class="s1">&#39;forest_metrics&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="n">forest</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;forest_metrics&#39;</span><span class="p">]</span>

            <span class="c1"># Forest height proxy</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">forest</span><span class="p">[</span><span class="s1">&#39;height_proxy&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlGn&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Forest Height Proxy&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">])</span>
            <span class="n">plot_idx</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Biomass proxy</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">forest</span><span class="p">[</span><span class="s1">&#39;biomass_proxy&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Biomass Proxy (dB)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">])</span>
            <span class="n">plot_idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="s1">&#39;urban_features&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="n">urban</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;urban_features&#39;</span><span class="p">]</span>

            <span class="c1"># Building mask</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">urban</span><span class="p">[</span><span class="s1">&#39;building_mask&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Building Detection&#39;</span><span class="p">)</span>
            <span class="n">plot_idx</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Urban density</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">urban</span><span class="p">[</span><span class="s1">&#39;urban_density&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Urban Density&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">])</span>
            <span class="n">plot_idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="s1">&#39;crop_analysis&#39;</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
            <span class="n">crop</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;crop_analysis&#39;</span><span class="p">]</span>

            <span class="c1"># Field map</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">crop</span><span class="p">[</span><span class="s1">&#39;field_map&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Field Segmentation&#39;</span><span class="p">)</span>
            <span class="n">plot_idx</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Crop development</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">crop</span><span class="p">[</span><span class="s1">&#39;crop_development&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlGn&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Crop Development&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">])</span>
            <span class="n">plot_idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Hide unused subplots</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">plot_idx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_path</span> <span class="o">/</span> <span class="s1">&#39;workflow_summary.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;show_plots&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;visualization_path&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_path</span> <span class="o">/</span> <span class="s1">&#39;workflow_summary.png&#39;</span><span class="p">),</span>
            <span class="s1">&#39;plots_generated&#39;</span><span class="p">:</span> <span class="n">plot_idx</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">input_data</span>

<span class="k">def</span><span class="w"> </span><span class="nf">export_workflow_results</span><span class="p">(</span><span class="n">workflow_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export workflow results in multiple formats&quot;&quot;&quot;</span>

    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
    <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Export numerical results to MATLAB format</span>
    <span class="n">matlab_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">workflow_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">matlab_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">subkey</span><span class="p">,</span> <span class="n">subvalue</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subvalue</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">matlab_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">subkey</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subvalue</span>

    <span class="k">if</span> <span class="n">matlab_data</span><span class="p">:</span>
        <span class="n">save_matlab_mat</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;workflow_results.mat&#39;</span><span class="p">),</span> <span class="n">matlab_data</span><span class="p">)</span>

    <span class="c1"># Export metadata and statistics to JSON</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">workflow_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;statistics&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;statistics&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;quality_metrics&#39;</span><span class="p">,</span> <span class="s1">&#39;processing_info&#39;</span><span class="p">]:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;workflow_metadata.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># Create summary report</span>
    <span class="n">report_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;# Workflow Results Summary</span>

<span class="s2">Generated: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span>

<span class="s2">## Processing Overview</span>
<span class="s2">- Workflow completed successfully</span>
<span class="s2">- Results exported to: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span>

<span class="s2">## Files Generated</span>
<span class="s2">- workflow_results.mat: Numerical results in MATLAB format</span>
<span class="s2">- workflow_metadata.json: Processing metadata and statistics</span>
<span class="s2">- workflow_summary.png: Visualization summary</span>

<span class="s2">## Quality Assessment</span>
<span class="s2">&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s1">&#39;quality_metrics&#39;</span> <span class="ow">in</span> <span class="n">workflow_results</span><span class="p">:</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="n">workflow_results</span><span class="p">[</span><span class="s1">&#39;quality_metrics&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;snr_mean&#39;</span> <span class="ow">in</span> <span class="n">quality</span><span class="p">:</span>
            <span class="n">report_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- Mean SNR: </span><span class="si">{</span><span class="n">quality</span><span class="p">[</span><span class="s1">&#39;snr_mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> dB</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;speckle_reduction_factor&#39;</span> <span class="ow">in</span> <span class="n">quality</span><span class="p">:</span>
            <span class="n">report_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- Speckle reduction factor: </span><span class="si">{</span><span class="n">quality</span><span class="p">[</span><span class="s1">&#39;speckle_reduction_factor&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;overall_quality&#39;</span> <span class="ow">in</span> <span class="n">quality</span><span class="p">:</span>
            <span class="n">report_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- Overall quality: </span><span class="si">{</span><span class="s1">&#39;GOOD&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">quality</span><span class="p">[</span><span class="s1">&#39;overall_quality&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;POOR&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;README.md&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report_content</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results exported to: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Visualization and export functions implemented&quot;</span><span class="p">)</span>
</code></pre>
<h2 id="7-complete-workflow-example">7. Complete Workflow Example</h2>
<h3 id="71-execute-a-complete-custom-workflow">7.1 Execute a Complete Custom Workflow</h3>
<pre class="codehilite"><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_complete_workflow</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate a complete custom workflow execution&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== CUSTOM WORKFLOW DEMONSTRATION ===&quot;</span><span class="p">)</span>

    <span class="c1"># Create a comprehensive forest monitoring workflow</span>
    <span class="n">comprehensive_workflow</span> <span class="o">=</span> <span class="n">create_forest_monitoring_workflow</span><span class="p">(</span>
        <span class="s2">&quot;path/to/demo_data.dim&quot;</span><span class="p">,</span>  <span class="c1"># Update with actual path</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/comprehensive_demo&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Add optimization and error handling</span>
    <span class="n">comprehensive_workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">PerformanceOptimizationStep</span><span class="p">({</span>
        <span class="s1">&#39;enable_memory_optimization&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;enable_parallel_processing&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;memory_threshold_mb&#39;</span><span class="p">:</span> <span class="mi">100</span>
    <span class="p">}))</span>

    <span class="n">comprehensive_workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">ErrorHandlingStep</span><span class="p">({</span>
        <span class="s1">&#39;replace_nan&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;replace_inf&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}))</span>

    <span class="c1"># Add forest-specific analysis</span>
    <span class="n">comprehensive_workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">ForestMetricsStep</span><span class="p">({}))</span>

    <span class="c1"># Add visualization</span>
    <span class="n">comprehensive_workflow</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">WorkflowVisualizationStep</span><span class="p">({</span>
        <span class="s1">&#39;output_path&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/comprehensive_demo&quot;</span><span class="p">,</span>
        <span class="s1">&#39;show_plots&#39;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}))</span>

    <span class="c1"># Register and execute</span>
    <span class="n">workflow_manager</span><span class="o">.</span><span class="n">register_workflow</span><span class="p">(</span><span class="n">comprehensive_workflow</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># In a real scenario, provide actual file path</span>
        <span class="n">demo_input</span> <span class="o">=</span> <span class="s2">&quot;demo_data_path.dim&quot;</span>  <span class="c1"># Placeholder</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing comprehensive workflow with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">comprehensive_workflow</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span><span class="si">}</span><span class="s2"> steps...&quot;</span><span class="p">)</span>

        <span class="c1"># This would fail with placeholder data, so we&#39;ll demonstrate the structure</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workflow structure:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">comprehensive_workflow</span><span class="o">.</span><span class="n">steps</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Step </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Note: Provide actual SAR data file to execute the workflow&quot;</span><span class="p">)</span>

        <span class="c1"># Show execution statistics</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">workflow_manager</span><span class="o">.</span><span class="n">get_execution_statistics</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Workflow Manager Statistics:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Registered workflows: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">workflows</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Cache directory: </span><span class="si">{</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">cache_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Demo execution note: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is expected with placeholder data&quot;</span><span class="p">)</span>

<span class="c1"># Run demonstration</span>
<span class="n">demonstrate_complete_workflow</span><span class="p">()</span>

<span class="c1"># Generate automated processing script example</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating automated processing script...&quot;</span><span class="p">)</span>
<span class="n">script_path</span> <span class="o">=</span> <span class="n">create_automated_processing_script</span><span class="p">(</span>
    <span class="n">workflow_configs</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;forest_monitoring&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;num_looks&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;overlap_factor&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span>
        <span class="s1">&#39;urban_monitoring&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;num_looks&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;overlap_factor&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="n">batch_configs</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;Forest Monitoring&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;file1.dim&#39;</span><span class="p">,</span> <span class="s1">&#39;file2.dim&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Urban Monitoring&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;urban1.dim&#39;</span><span class="p">,</span> <span class="s1">&#39;urban2.dim&#39;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Automated script generated: </span><span class="si">{</span><span class="n">script_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== TUTORIAL 6 SUMMARY ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom workflow framework implemented with:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Modular processing steps&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Application-specific workflows (Forest, Urban, Agriculture)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Performance optimization and error handling&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Batch processing capabilities&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Advanced workflow management with caching&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Comprehensive visualization and export&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Automated script generation&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Next: Apply these concepts to your specific SAR processing needs!&quot;</span><span class="p">)</span>
</code></pre>
<h2 id="summary">Summary</h2>
<p>In this tutorial, you learned:</p>
<ol>
<li><strong>Modular workflow architecture</strong> with abstract base classes</li>
<li><strong>Application-specific processing steps</strong> for different use cases</li>
<li><strong>Advanced workflow management</strong> with caching and monitoring</li>
<li><strong>Performance optimization</strong> techniques for large datasets</li>
<li><strong>Robust error handling</strong> and data validation</li>
<li><strong>Batch processing frameworks</strong> for multiple datasets</li>
<li><strong>Automated script generation</strong> for production workflows</li>
<li><strong>Comprehensive visualization</strong> and result export</li>
</ol>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li><strong>Tutorial 7</strong>: Ship detection with CFAR algorithms</li>
<li><strong>Tutorial 8</strong>: Advanced interferometric analysis</li>
<li>Adapt workflows to your specific applications</li>
<li>Integrate with cloud processing platforms</li>
<li>Develop domain-specific processing modules</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<p><strong>Common Issues:</strong></p>
<ol>
<li><strong>Memory limitations</strong>: Implement chunked processing for large datasets</li>
<li><strong>Step failures</strong>: Use error handling steps and robust validation</li>
<li><strong>Performance bottlenecks</strong>: Apply optimization steps and parallel processing</li>
<li><strong>Cache issues</strong>: Clear cache directory or disable caching</li>
<li><strong>Workflow configuration</strong>: Validate step dependencies and data flow</li>
</ol>
<p>For more help, see the <a href="../user_guide/troubleshooting.html">Troubleshooting Guide</a> and <a href="../developer_guide/">Developer Guide</a> (coming soon).</p>
    <div class="footer">
      sarpyx Documentation &nbsp;·&nbsp; built with <code>build_site.py</code>
    </div>
  </main>
</body>
</html>
